<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Floorball Scoreboard - Wide Bar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --navy-dark: #0a192f;
            --navy-medium: #112240;
            --gold: #fbbf24;
            --accent-blue: #3b82f6;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: transparent; 
            min-height: 100vh;
        }
        
        .score-font {
            font-family: 'ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', monospace;
            font-weight: 900;
            font-variant-numeric: tabular-nums;
        }

        .team-name-display {
            font-weight: 800;
            letter-spacing: 0.02em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: block;
        }
        
        .navy-bg { background-color: var(--navy-dark); }
        .navy-accent { background-color: var(--navy-medium); }

        /* Increased Height and Wide profile for OBS */
        .scoreboard-bar {
            height: 90px;
            display: flex;
            align-items: stretch;
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.6);
            transition: all 0.3s ease;
        }

        .team-block {
            display: flex;
            align-items: center;
            padding: 0 25px;
            flex: 1 1 0%; 
            min-width: 0; 
        }

        .goal-box {
            width: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            background: rgba(255,255,255,0.05);
            border-left: 1px solid rgba(255,255,255,0.1);
            border-right: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0; 
        }

        .center-info {
            width: 260px; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-left: 4px solid var(--accent-blue);
            border-right: 4px solid var(--accent-blue);
            flex-shrink: 0;
        }

        .timer-text {
            color: var(--gold);
            font-family: 'ui-monospace', monospace;
            font-weight: 700;
            font-size: 2.5rem;
            line-height: 1;
        }

        .period-text {
            font-size: 0.9rem;
            font-weight: 900;
            color: #94a3b8;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            margin-bottom: 2px;
        }

        .hidden-panel { display: none !important; }

        @media (max-width: 767px) {
            .scoreboard-bar { height: 60px; }
            .team-block { padding: 0 15px; }
            .team-name-display { font-size: 1rem; }
            .goal-box { width: 60px; font-size: 2rem; }
            .center-info { width: 140px; border-left-width: 2px; border-right-width: 2px; }
            .timer-text { font-size: 1.5rem; }
            .period-text { font-size: 0.6rem; }
        }
    </style>
</head>
<body class="p-4 flex flex-col items-center justify-start">

    <!-- Widened & Tall Horizontal Bar Scoreboard -->
    <div id="mainWrapper" class="main-wrapper w-full max-w-[1400px] rounded-xl overflow-hidden border border-white/10 navy-bg scoreboard-bar mb-10">
        <!-- Home Team Block -->
        <div class="team-block">
            <div id="displayTeam1" class="text-white team-name-display uppercase flex-1 text-2xl lg:text-3xl mr-4">HOME TEAM</div>
            <div id="score1" class="score-font text-white goal-box h-full">0</div>
        </div>

        <!-- Center Match Info -->
        <div class="center-info navy-accent">
            <div class="period-text">PERIOD <span id="periodDisplay">1</span></div>
            <div id="timer" class="timer-text">00:00</div>
        </div>

        <!-- Away Team Block -->
        <div class="team-block flex-row-reverse">
            <div id="displayTeam2" class="text-white team-name-display uppercase flex-1 text-right text-2xl lg:text-3xl ml-4">AWAY TEAM</div>
            <div id="score2" class="score-font text-white goal-box h-full">0</div>
        </div>
    </div>

    <!-- Password Modal -->
    <div id="passwordModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center hidden-panel">
        <div class="bg-slate-900 p-8 rounded-2xl border border-white/10 shadow-2xl w-full max-w-sm">
            <h2 class="text-white font-bold mb-4 text-center">Floorball Admin Access</h2>
            <input type="password" id="passwordInput" placeholder="Enter Password" class="w-full bg-slate-800 text-white p-3 rounded-lg mb-4 outline-none border border-white/5 focus:border-blue-500">
            <div class="flex gap-2">
                <button id="cancelBtn" class="flex-1 py-2 text-slate-400 text-sm hover:text-white">Cancel</button>
                <button id="submitPassBtn" class="flex-2 bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded-lg font-bold">Unlock</button>
            </div>
            <p id="errorMsg" class="text-red-500 text-[10px] mt-2 text-center hidden">Incorrect password.</p>
        </div>
    </div>

    <!-- Protected Control Panel -->
    <div id="adminPanel" class="control-panel bg-slate-900/95 p-5 rounded-2xl border border-white/10 w-full max-w-md text-white shadow-xl hidden-panel">
        <div class="flex justify-between items-center mb-4">
            <p class="text-[10px] font-black text-blue-400 uppercase tracking-widest">Floorball Control Panel</p>
            <button id="logoutBtn" class="text-[9px] text-slate-500 hover:text-red-400 uppercase">Logout</button>
        </div>

        <!-- Team Names -->
        <div class="mb-5 space-y-3 bg-white/5 p-4 rounded-xl border border-white/5">
            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label class="text-[9px] text-slate-500 uppercase block mb-1">Home Name</label>
                    <input type="text" id="inputTeam1" placeholder="HOME" class="w-full bg-slate-800 border-none rounded p-2 text-sm focus:ring-1 focus:ring-blue-500 outline-none text-white">
                </div>
                <div>
                    <label class="text-[9px] text-slate-500 uppercase block mb-1">Away Name</label>
                    <input type="text" id="inputTeam2" placeholder="AWAY" class="w-full bg-slate-800 border-none rounded p-2 text-sm focus:ring-1 focus:ring-blue-500 outline-none text-white">
                </div>
            </div>
        </div>

        <!-- Timer Control -->
        <div class="bg-white/5 p-4 rounded-xl border border-white/5 mb-5">
            <div class="flex justify-between items-center mb-3">
                <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Match Timer</p>
                <div class="flex items-center gap-1">
                    <input type="number" id="matchLength" value="20" class="w-8 bg-transparent text-center text-xs font-bold text-yellow-500 outline-none">
                    <span class="text-[9px] text-slate-500 uppercase">Min</span>
                </div>
            </div>
            <div class="flex gap-2">
                <button id="timerBtn" class="bg-emerald-600 hover:bg-emerald-500 flex-1 py-2.5 rounded-lg font-bold text-xs uppercase">Start Timer</button>
                <button id="resetTimerBtn" class="bg-slate-700 px-4 py-2.5 rounded-lg text-xs font-bold uppercase">Reset</button>
            </div>
        </div>

        <!-- Goals & Period -->
        <div class="grid grid-cols-2 gap-4 mb-5">
            <div class="space-y-2">
                <p class="text-[10px] font-bold text-slate-500 uppercase text-center">Home Goals</p>
                <div class="flex gap-1">
                    <button id="btnHPlus" class="bg-blue-600 hover:bg-blue-500 flex-1 py-3 rounded-lg font-bold text-lg">+</button>
                    <button id="btnHMinus" class="bg-slate-800 px-3 rounded-lg">-</button>
                </div>
            </div>
            <div class="space-y-2">
                <p class="text-[10px] font-bold text-slate-500 uppercase text-center">Away Goals</p>
                <div class="flex gap-1">
                    <button id="btnAPlus" class="bg-blue-600 hover:bg-blue-500 flex-1 py-3 rounded-lg font-bold text-lg">+</button>
                    <button id="btnAMinus" class="bg-slate-800 px-3 rounded-lg">-</button>
                </div>
            </div>
        </div>

        <div class="flex flex-col gap-2 pt-4 border-t border-white/5">
            <div class="flex gap-2">
                <button id="btnPPrev" class="bg-slate-800 px-4 py-3 rounded-lg text-xs font-bold uppercase">Prev</button>
                <button id="btnPNext" class="flex-1 bg-yellow-600 hover:bg-yellow-500 py-3 rounded-lg font-bold text-xs uppercase">Next Period</button>
            </div>
            <button id="btnResetAll" class="bg-red-900/20 hover:bg-red-900/40 text-red-400 text-[10px] uppercase font-bold py-2 rounded-lg transition-colors mt-2">Reset Entire Match</button>
        </div>

        <div class="mt-4 text-[9px] text-slate-500 text-center uppercase tracking-widest opacity-60">
            Keys: Q/A (Home) | W/S (Away) | Space (Time) | N (Period)
        </div>
    </div>

    <!-- Viewer/Login Section -->
    <div id="viewerSection" class="mt-4 flex flex-col items-center gap-4">
        <div class="px-4 py-2 bg-white/5 border border-white/10 rounded-full text-[10px] text-slate-400 uppercase tracking-widest">
            Broadcasting Live
        </div>
        <button id="loginTriggerBtn" class="text-[10px] text-slate-500 hover:text-blue-400 uppercase tracking-widest border-b border-transparent hover:border-blue-400/30 transition-all">
            Admin Control
        </button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // CONFIG
        const firebaseConfig = JSON.parse(__firebase_config);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'floorball-wide-v1';
        const ADMIN_PASSWORD = "vball2024"; 

        let IS_AUTHORIZED = sessionStorage.getItem('floorball_admin_auth') === 'true';
        let state = {
            score1: 0, score2: 0, period: 1,
            timeSeconds: 0, timerRunning: false,
            team1Name: "HOME TEAM", team2Name: "AWAY TEAM"
        };

        // FIREBASE
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let localTimer = null;

        // UI ELEMENTS
        const adminPanel = document.getElementById('adminPanel');
        const viewerSection = document.getElementById('viewerSection');
        const passwordModal = document.getElementById('passwordModal');
        const passwordInput = document.getElementById('passwordInput');
        const errorMsg = document.getElementById('errorMsg');

        const init = async () => {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }

            onAuthStateChanged(auth, (user) => {
                if (!user) return;
                
                if (IS_AUTHORIZED) activateAdminMode();

                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'match', 'state');
                onSnapshot(docRef, (snapshot) => {
                    if (snapshot.exists()) {
                        const data = snapshot.data();
                        state = { ...state, ...data };
                        updateDisplay();
                        handleTimerState();
                        if (IS_AUTHORIZED) syncAdminInputs();
                    } else if (IS_AUTHORIZED) {
                        pushState();
                    }
                }, (err) => console.error("Firestore error:", err));
            });
        };

        // AUTH
        document.getElementById('loginTriggerBtn').onclick = () => {
            passwordModal.classList.remove('hidden-panel');
            passwordInput.focus();
        };

        document.getElementById('submitPassBtn').onclick = checkPass;
        passwordInput.onkeypress = (e) => { if (e.key === 'Enter') checkPass(); };
        document.getElementById('cancelBtn').onclick = () => {
            passwordModal.classList.add('hidden-panel');
            errorMsg.classList.add('hidden');
        };

        document.getElementById('logoutBtn').onclick = () => {
            sessionStorage.removeItem('floorball_admin_auth');
            window.location.reload();
        };

        function checkPass() {
            if (passwordInput.value === ADMIN_PASSWORD) {
                IS_AUTHORIZED = true;
                sessionStorage.setItem('floorball_admin_auth', 'true');
                passwordModal.classList.add('hidden-panel');
                activateAdminMode();
                pushState();
            } else {
                errorMsg.classList.remove('hidden');
                passwordInput.value = '';
            }
        }

        function activateAdminMode() {
            adminPanel.classList.remove('hidden-panel');
            viewerSection.classList.add('hidden-panel');
            setupAdminListeners();
            syncAdminInputs();
        }

        // STATE LOGIC
        async function pushState() {
            if (!IS_AUTHORIZED || !auth.currentUser) return;
            const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'match', 'state');
            try { await setDoc(docRef, state, { merge: true }); } catch (e) { console.error(e); }
        }

        function updateDisplay() {
            document.getElementById('displayTeam1').innerText = state.team1Name;
            document.getElementById('displayTeam2').innerText = state.team2Name;
            document.getElementById('score1').innerText = state.score1;
            document.getElementById('score2').innerText = state.score2;
            document.getElementById('periodDisplay').innerText = state.period;

            const mins = Math.floor(state.timeSeconds / 60);
            const secs = state.timeSeconds % 60;
            const timeStr = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            document.getElementById('timer').innerText = timeStr;

            const limit = parseInt(document.getElementById('matchLength').value) || 20;
            if (mins >= limit) document.getElementById('timer').classList.add('text-red-500');
            else document.getElementById('timer').classList.remove('text-red-500');
        }

        function syncAdminInputs() {
            if (document.activeElement.id !== 'inputTeam1') document.getElementById('inputTeam1').value = state.team1Name;
            if (document.activeElement.id !== 'inputTeam2') document.getElementById('inputTeam2').value = state.team2Name;
        }

        function handleTimerState() {
            const btn = document.getElementById('timerBtn');
            if (state.timerRunning) {
                btn.innerText = "STOP TIMER";
                btn.classList.replace('bg-emerald-600', 'bg-red-600');
                if (!localTimer) {
                    localTimer = setInterval(() => {
                        state.timeSeconds++;
                        updateDisplay();
                        // Push only periodically or on stop to save ops
                        if (state.timeSeconds % 5 === 0) pushState();
                    }, 1000);
                }
            } else {
                btn.innerText = "START TIMER";
                btn.classList.replace('bg-red-600', 'bg-emerald-600');
                clearInterval(localTimer);
                localTimer = null;
            }
        }

        function setupAdminListeners() {
            const push = () => pushState();
            
            document.getElementById('inputTeam1').oninput = (e) => { state.team1Name = e.target.value || "HOME"; updateDisplay(); push(); };
            document.getElementById('inputTeam2').oninput = (e) => { state.team2Name = e.target.value || "AWAY"; updateDisplay(); push(); };

            document.getElementById('timerBtn').onclick = () => { state.timerRunning = !state.timerRunning; handleTimerState(); push(); };
            document.getElementById('resetTimerBtn').onclick = () => { state.timerRunning = false; state.timeSeconds = 0; handleTimerState(); updateDisplay(); push(); };

            document.getElementById('btnHPlus').onclick = () => { state.score1++; updateDisplay(); push(); };
            document.getElementById('btnHMinus').onclick = () => { state.score1 = Math.max(0, state.score1 - 1); updateDisplay(); push(); };
            document.getElementById('btnAPlus').onclick = () => { state.score2++; updateDisplay(); push(); };
            document.getElementById('btnAMinus').onclick = () => { state.score2 = Math.max(0, state.score2 - 1); updateDisplay(); push(); };

            document.getElementById('btnPNext').onclick = () => { state.period = Math.min(5, state.period + 1); updateDisplay(); push(); };
            document.getElementById('btnPPrev').onclick = () => { state.period = Math.max(1, state.period - 1); updateDisplay(); push(); };

            document.getElementById('btnResetAll').onclick = () => {
                state = { score1: 0, score2: 0, period: 1, timeSeconds: 0, timerRunning: false, team1Name: "HOME TEAM", team2Name: "AWAY TEAM" };
                updateDisplay(); syncAdminInputs(); push();
            };

            window.onkeydown = (e) => {
                if (document.activeElement.tagName === 'INPUT' || !IS_AUTHORIZED) return;
                const k = e.key.toLowerCase();
                if (k === 'q') document.getElementById('btnHPlus').click();
                if (k === 'a') document.getElementById('btnHMinus').click();
                if (k === 'w') document.getElementById('btnAPlus').click();
                if (k === 's') document.getElementById('btnAMinus').click();
                if (k === 'n') document.getElementById('btnPNext').click();
                if (k === ' ') { e.preventDefault(); document.getElementById('timerBtn').click(); }
            };
        }

        init();
    </script>
</body>
</html>
